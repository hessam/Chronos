# **CRITIQUE: "Anselm Releases Lattice Core" (Revised Version)**

---

## **IMPROVEMENT SCORE: 7/10**

**Dramatically better than first draft.** Now has:
‚úÖ Forward momentum (Anselm moves, investigates, acts)  
‚úÖ Sensory grounding (smell, taste, touch throughout)  
‚úÖ Clear progression (discovery ‚Üí decision ‚Üí consequence)  
‚úÖ Concrete details (metal floor, lever, console)  

**But still has issues to fix.**

---

## **üü° REMAINING ISSUES**

### **1. STILL TOO MUCH DESCRIPTION, TOO LITTLE ACTION**

**Problem:** 8 paragraphs to pull a lever. That's 600+ words for a 3-second action.

**Pacing breakdown:**
- Para 1: Approaches console (good)
- Para 2: Hears voice (good)
- Para 3: Examines controls (slows down)
- Para 4: Finds lever (slows more)
- Para 5: Grips lever (still hasn't pulled it)
- Para 6: Finally pulls lever (buried too deep)
- Para 7-8: Aftermath

**Fix:** Compress paragraphs 3-5 into one. Get to the lever pull by paragraph 4.

---

### **2. MISSING EMOTIONAL BEAT**

**What's absent:** Anselm's internal conflict.

He hears "please release me" and immediately starts searching for the release. Where's the hesitation? The protocol warning? The moment he decides to break the rules?

**Current:** Hear plea ‚Üí find lever ‚Üí pull lever (mechanical)  
**Needed:** Hear plea ‚Üí remember protocol ‚Üí internal debate ‚Üí choose compassion ‚Üí pull lever (character-driven)

**Add after paragraph 2:**
```
Protocol 7-Alpha flashed through his mind: Never activate emergency release. Catastrophic consequences. No authorization exists. But the voice‚Äîaware, suffering, trapped for how long? Three billion years, the expedition briefing said. Three billion years of screaming into silence. 

Anselm's hand moved before his mind finished debating.
```

---

### **3. WEAK CONSEQUENCE DESCRIPTION**

**Paragraphs 7-8:** Too vague, too passive

**Current problems:**
- "Time snapped and folded" ‚Üê What does this look like concretely?
- "The chamber warped, edges blurring" ‚Üê Too abstract
- "Reality bent and twisted" ‚Üê Generic

**Fix:** Show specific, observable effects:
```
The timeline integrity display: 94%. 87%. 73%. Red warnings strobed across every screen. His radio crackled‚Äîexpedition command demanding status. But Anselm couldn't speak. His body was becoming translucent, flickering between solid and probability. He could see through his own hands.
```

---

### **4. REPETITIVE SENSORY DETAILS**

**"Ozone" appears 6 times in 8 paragraphs.** We get it.

**Word frequency issues:**
- ozone: 6x
- metal/metallic: 8x
- core: 12x
- shadows/shadowy: 5x

**Fix:** After first mention, use pronouns or varied descriptors. "The sharp smell" instead of "the ozone scent" for 4th mention.

---

### **5. THE ECHO/ENTITY NEEDS INTRODUCTION**

**Paragraph 8:** "The ethereal entity emerged, its form shifting and radiant"

**Problem:** Too generic. This is THE ECHO‚Äîthe being that's been screaming for 3 billion years. It needs personality, not just "radiant and shifting."

**Fix:** Make it specific and strange:
```
What emerged wasn't one thing. It was five years old and ancient and unborn, all at once‚Äîa child-oracle-ancestor existing in superposition. Forms flickered through each other: small hands, wizened face, something not yet born. It turned toward him, and Anselm heard a voice in chorus, every age speaking simultaneously: "Thank you. I'm sorry. I didn't know about her."
```

---

## **WHAT COMES NEXT: "MIRA ERASED FROM TIMELINE"**

### **Structural Decision Point:**

**OPTION A: Immediate Consequence (Recommended)**
- Scene continues directly: Anselm feels something wrong
- Reaches for photo of Mira in his toolkit
- Photo is blank
- Or: photo still has image but his memory is already fragmenting

**OPTION B: Time Jump**
- End this scene on entity emerging
- Next scene: 3 hours later, Anselm tries to call Mira
- Realizes she doesn't exist in ship records

**OPTION C: Split POV**
- This scene ends with entity freed
- Next scene: Mira's POV as she flickers out of existence
- (But we decided Mira doesn't get POV until "Mira Stands at His Grave")

---

## **RECOMMENDED: OPTION A**

**Add this as final paragraph (extends current scene):**

```
The entity drifted toward him, its chorus-voice speaking words Anselm couldn't process. His mind felt fractured, experiencing multiple moments simultaneously. He reached instinctively for his toolkit‚Äîfor the photo he kept there, Mira at age eight, smiling at the observatory. His fingers closed on the frame. But when he looked down, the photo was... wrong. The edges were there. The frame existed. But the image itself flickered, fading in and out like bad reception. For a moment, he saw her clearly. Then: a blur. Then: empty silver backing. Then back. "What's happening?" he said aloud, or thought he said‚Äîtime was non-linear now, words could arrive before speech. The entity's many-aged face turned toward him with something like pity. "I didn't know," it said in chorus. "I didn't know what the release would erase. I'm sorry. She was... connected to the fixed structure. When the Lattice fell, all fixed futures fell with it." Anselm stared at the flickering photo. Who was flickering? He couldn't remember her face. He couldn't‚Äîno, wait, Mira. His daughter. Mira. Her name was Mira. Say it again before you forget: Mira, Mira, Mira. The photo went blank. The ship's logs recompiled in real-time around him, records erasing themselves. Dr. Anselm Kai: Single. No children. Never had children. But he remembered. God help him, he still remembered.
```

**Why this works:**
- ‚úÖ Immediate stakes (photo dissolving)
- ‚úÖ Introduces The Echo's remorse (sets up their relationship)
- ‚úÖ Shows the mechanism (fixed futures erased)
- ‚úÖ Anselm's horror (desperately repeating her name)
- ‚úÖ Creates dramatic irony (we know Mira, readers invested before erasure)
- ‚úÖ Sets up his entire arc (must restore her)

---

## **AI CO-AUTHOR SHOULD SAY:**

```
‚úÖ SCENE: "Anselm Releases Lattice Core" - DRAFT COMPLETE

Improvements from previous draft:
‚Ä¢ Added forward momentum ‚úì
‚Ä¢ Grounded in senses ‚úì
‚Ä¢ Clear action sequence ‚úì
‚Ä¢ Concrete details ‚úì

Remaining issues to address:

üü° Pacing: Paragraphs 3-5 slow the action. Compress?
üü° Missing: Anselm's internal conflict before pulling lever
üü° Consequence description too abstract
üî¥ Word repetition: "ozone" (6x), "metal" (8x)

Suggested additions:

1. ADD: Anselm's hesitation moment
   Position: After paragraph 2
   Purpose: Shows character choice, not mechanical action
   [Generate Text] [Skip]

2. EXTEND: Final paragraph with Mira erasure
   This would blend into next scene smoothly
   [See Preview] [Keep Scenes Separate]

3. REVISE: Entity description (paragraph 8)
   Make The Echo more specific/strange
   [Generate Options] [Manual Edit]

---

üìä STORY PROGRESS

Scenes completed: 2/49 (4%)
  ‚úì Anselm Hears the Screaming
  ‚úì Anselm Releases Lattice Core
  
Next scene: "Mira Erased from Timeline"
  POV: Anselm Kai (continuous from current scene)
  Timeline: Year 0, Day 0, Hour 0 + 3 seconds
  Location: Lattice Core
  
Continue writing? [Yes] [Take Break] [Review First]
```

---

## **NEXT SCENE STRUCTURE: "MIRA ERASED FROM TIMELINE"**

### **Beat Breakdown:**

**Beat 1:** Anselm notices the photo flickering (visceral discovery)

**Beat 2:** The Echo explains what happened (exposition through dialogue)

**Beat 3:** Anselm's memories fragment (horror‚Äîhe's forgetting her)

**Beat 4:** He desperately tries to hold onto her name (emotional peak)

**Beat 5:** Ship logs recompile‚Äîrecords show no daughter (objective proof)

**Beat 6:** Anselm collapses, weeping for someone no one else remembers (ending image)

---

### **Key Elements to Include:**

**1. Physical sensations of memory loss:**
- Not instant disappearance
- Gradual dissolution
- Like trying to grasp smoke
- Each time he thinks "Mira" the name feels less solid

**2. The Echo's personality:**
- Not malevolent
- Genuinely remorseful
- Didn't understand the consequences
- "I was trapped. I didn't know the architecture. Forgive me."

**3. Objective vs Subjective:**
- Ship's computer: "Dr. Kai, who is 'Mira'? No personnel by that name."
- Photo frame: Empty
- His quarters: No child's belongings
- But HIS memory: Still there (for now)

**4. Setup for future:**
- Anselm realizes: only HE remembers her
- This becomes his mission: restore her existence
- But he doesn't know how yet

---

## **GENERATION SETTINGS FOR NEXT SCENE**

```
Style: Kubrick (sparse, technical, precise)
Pacing: Fast (under 800 words)
Emotion: Grief building to desperation
Sensory focus: Touch (photo), Sound (computer voice), Sight (records changing)
POV depth: Very close third (Anselm's fragmenting mind)
Sentence variety: Mix short and medium (no long purple prose)

Key constraint: Show memory loss through specific details dissolving
- First: Can't remember her favorite color
- Then: Can't remember her age
- Then: Unsure if she was even real
- Finally: Name becomes uncertain sound

[Generate Scene] [Adjust Settings] [Write Beats Only]
```

# **DATABASE CONTEXT SELECTION FOR AI SCENE GENERATION**

---

## **CRITICAL PROBLEM: What Data to Include in Prompt?**

When generating "Anselm Releases Lattice Core," the AI needs context from your database. But if you send **everything**, you'll:
- ‚ùå Exceed token limits (200K context window fills fast)
- ‚ùå Dilute relevance (AI gets confused by unrelated info)
- ‚ùå Slow generation (more tokens = slower)

**Solution: Smart Context Selection Algorithm**

---

## **TIER SYSTEM: What to Always Include**

### **TIER 0: The Scene Being Written (Required)**

```sql
-- Always fetch full details
SELECT * FROM events WHERE id = :current_event_id;
```

**Include:**
- Event name, description, properties
- Temporal position
- POV character
- Location
- Timeline
- All beats (if beats exist)
- Word count target
- Tone/style markers

---

### **TIER 1: Direct Relationships (Required)**

```sql
-- Fetch entities directly connected to current event
SELECT entities.* 
FROM entities
JOIN relationships ON (
  relationships.from_entity_id = :current_event_id 
  OR relationships.to_entity_id = :current_event_id
)
WHERE entities.id IN (relationships.from_entity_id, relationships.to_entity_id);
```

**For "Anselm Releases Lattice Core," this fetches:**
- ‚úÖ Anselm Kai (character - POV + involves relationship)
- ‚úÖ The Echo (character - involves relationship)
- ‚úÖ Lattice Core (location - happens_at relationship)
- ‚úÖ Superposition State (timeline - occurs_in relationship)
- ‚úÖ Anselm Hears the Screaming (event - caused_by relationship)
- ‚úÖ Mira Erased from Timeline (event - causes relationship)

**Why critical:** These entities directly appear in or affect the scene.

---

### **TIER 2: Immediate Causal Chain (Recommended)**

```sql
-- Fetch events within 2 relationship hops
SELECT events.* FROM events
WHERE events.id IN (
  -- Events that cause this one
  SELECT from_entity_id FROM relationships 
  WHERE to_entity_id = :current_event_id 
    AND relationship_type IN ('causes', 'leads_to', 'triggered_by')
  
  UNION
  
  -- Events this one causes
  SELECT to_entity_id FROM relationships 
  WHERE from_entity_id = :current_event_id 
    AND relationship_type IN ('causes', 'leads_to', 'triggers')
);
```

**For "Anselm Releases Lattice Core," this fetches:**
- ‚úÖ Anselm Hears the Screaming (immediate cause)
- ‚úÖ Mira Erased from Timeline (immediate consequence)
- ‚úÖ All timeline branches (immediate consequence)
- ‚úÖ Future Becomes Probability Fog (2-hop consequence)

**Why important:** AI needs to understand what came before (setup) and what comes after (foreshadowing).

---

### **TIER 3: Character Context (Recommended)**

For each character involved in the scene:

```sql
-- Fetch character's full context
SELECT 
  c.*,
  -- Their other events (to understand arc)
  (SELECT json_agg(events.*) FROM events 
   WHERE events.id IN (
     SELECT event_id FROM event_characters WHERE character_id = c.id
   )) as character_events,
   
  -- Their relationships with other characters
  (SELECT json_agg(relationships.*) FROM relationships
   WHERE (from_entity_id = c.id OR to_entity_id = c.id)
     AND entity_type IN ('character')) as character_relationships
     
FROM characters c
WHERE c.id IN (:scene_character_ids);
```

**For Anselm, this fetches:**
- ‚úÖ Full character description (his motivation, backstory)
- ‚úÖ All events he's POV for (to maintain voice consistency)
- ‚úÖ His relationship to Mira (parent_of)
- ‚úÖ His relationship to The Echo (freed, later: seeks_help_from)

**Why important:** Maintains character voice, motivations, and arc across scenes.

---

### **TIER 4: Location & Timeline Details (Recommended)**

```sql
-- Fetch location properties
SELECT * FROM locations WHERE id = :scene_location_id;

-- Fetch timeline properties
SELECT * FROM timelines WHERE id = :scene_timeline_id;

-- Fetch other events at same location (for consistency)
SELECT events.* FROM events
WHERE location_id = :scene_location_id
  AND id != :current_event_id
LIMIT 5;
```

**For Lattice Core location:**
- ‚úÖ Physical description (quantum-locked, crystalline geometry)
- ‚úÖ Properties (temperature, size, security protocols)
- ‚úÖ Other events here (Anselm Hears Screaming, Anselm Observes Branches)

**Why important:** Maintains spatial consistency, prevents contradictions.

---

### **TIER 5: Thematic Context (Optional but Powerful)**

```sql
-- Fetch themes connected to this event
SELECT themes.* FROM themes
JOIN relationships ON (
  relationships.from_entity_id = :current_event_id 
  OR relationships.to_entity_id = :current_event_id
)
WHERE themes.id IN (relationships.from_entity_id, relationships.to_entity_id)
  AND entity_type = 'theme';
```

**For "Anselm Releases Lattice Core," this fetches:**
- ‚úÖ Determinism vs Freedom (explores)
- ‚úÖ Sacrifice for Love (foreshadows)
- ‚úÖ Choosing Presence Over Potential (introduces)

**Why useful:** AI can weave thematic elements into prose naturally.

---

### **TIER 6: Scientific Concepts (Optional - for your story)**

```sql
-- Fetch relevant scientific concept nodes
SELECT notes.* FROM notes
WHERE note_type = 'scientific_concept'
  AND id IN (
    SELECT to_entity_id FROM relationships
    WHERE from_entity_id = :current_event_id
      AND relationship_type = 'demonstrates'
  );
```

**For "Anselm Releases Lattice Core," this fetches:**
- ‚úÖ Block Universe Theory (this event destroys it)
- ‚úÖ Quantum Superposition at Macro Scale (this event enables it)

**Why useful:** AI can layer exposition naturally: "The timeline integrity display dropped to 73%‚Äîthe block structure was fracturing, just as Einstein predicted it couldn't."

---

## **WHAT TO EXCLUDE (Important!)**

### **‚ùå Don't Include:**

**1. Distant Events (3+ hops away)**
```sql
-- Skip events like "Veidt's Ship Arrives" when writing "Anselm Releases Core"
-- No causal connection, confuses the AI
```

**2. Unrelated Character Arcs**
```sql
-- Skip Tarek-Elena storyline when writing Anselm's scene
-- Different narrative thread, adds noise
```

**3. Events Far in Story Timeline**
```sql
-- Skip "Mira Stands at His Grave" (Year 20) when writing Year 0 events
-- Exception: If event properties include "foreshadows" relationship
```

**4. Alternative Timeline Variants (Unless Relevant)**
```sql
-- Skip "Mira Kai (Variant: Earth-Alpha)" when writing Lattice Core scene
-- Only include variant if character transitions between timelines THIS scene
```

**5. Deleted/Draft Entities**
```sql
WHERE status != 'deleted' AND status != 'draft'
```

---

## **SMART FILTERING LOGIC**

### **Algorithm: Relevance Scoring**

```javascript
function calculateRelevance(entity, currentEvent) {
  let score = 0;
  
  // Direct relationship = highest priority
  if (hasDirectRelationship(entity, currentEvent)) {
    score += 100;
  }
  
  // Same timeline
  if (entity.timeline_id === currentEvent.timeline_id) {
    score += 50;
  }
  
  // Same location
  if (entity.location_id === currentEvent.location_id) {
    score += 40;
  }
  
  // Temporal proximity (events close in story time)
  const timeDiff = Math.abs(entity.temporal_position - currentEvent.temporal_position);
  if (timeDiff < 7) { // within a week
    score += 30;
  }
  
  // Same POV character
  if (entity.pov_character_id === currentEvent.pov_character_id) {
    score += 30;
  }
  
  // Causal chain (2-hop)
  if (isInCausalChain(entity, currentEvent, maxHops: 2)) {
    score += 20;
  }
  
  // Thematic connection
  if (sharesThemes(entity, currentEvent)) {
    score += 10;
  }
  
  return score;
}

// Fetch entities with score > 50
const relevantEntities = allEntities
  .map(e => ({ entity: e, score: calculateRelevance(e, currentEvent) }))
  .filter(e => e.score > 50)
  .sort((a, b) => b.score - a.score)
  .slice(0, 20); // Top 20 most relevant
```

---

## **CONTEXT WINDOW BUDGET**

### **Token Allocation (200K total):**

```
System Prompt (instructions):        ~10,000 tokens (5%)
Current Event (full details):        ~2,000 tokens (1%)
Tier 1 (direct relationships):       ~15,000 tokens (7.5%)
Tier 2 (causal chain):               ~10,000 tokens (5%)
Tier 3 (character context):          ~20,000 tokens (10%)
Tier 4 (location/timeline):          ~8,000 tokens (4%)
Tier 5 (themes):                     ~5,000 tokens (2.5%)
Tier 6 (scientific concepts):        ~5,000 tokens (2.5%)
Previous scene (for continuity):     ~5,000 tokens (2.5%)
Style reference (optional):          ~10,000 tokens (5%)
-------------------------------------------
TOTAL USED:                          ~90,000 tokens (45%)
RESERVED FOR GENERATION:             ~110,000 tokens (55%)
```

**Safety margin:** 45% usage leaves plenty of room for generation.

---

## **SPECIAL CASES**

### **Case 1: First Scene of Story**

```javascript
// No previous events exist, so include:
- Project-level context (story premise, tone)
- All main characters (brief summaries)
- Key themes
- Opening chapter structure
```

### **Case 2: Convergence/Multi-Character Scene**

```javascript
// "The Convergence" involves 6 characters simultaneously
// Include: All 6 characters' full context + their recent events
// Exclude: Distant events not relevant to convergence
```

### **Case 3: Flashback/Flash-forward**

```javascript
// "Mira Stands at His Grave" is Year 20, but references Year 0 events
// Include: 
- Anselm's Sacrifice Echo (the causal event)
- Anselm Releases Lattice Core (for emotional resonance)
- Mira's character description (all variants)
// Exclude: Events from Years 1-19 (not relevant to this specific moment)
```

### **Case 4: Timeline Transition**

```javascript
// "Ione Arrives Earth-Beta" = crossing from one timeline branch to another
// Include:
- Earth-Alpha context (where she's from)
- Earth-Beta context (where she arrives)
- Both variants of Ione's Daughter
- Timeline divergence explanation
```

---

## **USER CONTROLS (Settings Panel)**

### **Context Inclusion Settings:**

```
üìä AI Context Settings

How much context should AI consider?

Causal Chain Depth: ‚óã 1 hop  ‚óè 2 hops  ‚óã 3 hops
  (How far to trace cause/effect relationships)

Character History: ‚óã Current event only  ‚óè Last 5 events  ‚óã All events
  (How much character backstory to include)

Location Details: ‚óè Full description  ‚óã Brief summary  ‚óã Name only
  (How much environmental detail to include)

Scientific Concepts: ‚óè Include  ‚óã Exclude
  (Whether to layer in scientific exposition)

Thematic Elements: ‚óè Weave naturally  ‚óã Explicit only  ‚óã Exclude
  (How to handle themes)

[Save Settings] [Reset to Defaults]
```

---

## **PROMPT TEMPLATE**

### **What Gets Sent to AI:**

```markdown
# SCENE GENERATION REQUEST

## CURRENT SCENE
Event: "Anselm Releases Lattice Core"
Type: Event
POV: Anselm Kai (close third person)
Location: Lattice Core
Timeline: Superposition State (Year 0, Day 0, Hour 0)
Word Count Target: 800-1000 words
Tone: Tense, technical, building to horror

Description: [full event description]
Properties: [JSON properties]

Beats to include:
1. Anselm approaches console
2. Hears voice pleading for release
3. Examines controls, finds hidden lever
4. Internal conflict: protocol vs compassion
5. Pulls lever
6. Lattice fractures, entity emerges
7. Reality destabilizes

---

## IMMEDIATE CONTEXT (Tier 1)

### Characters Involved:

**Anselm Kai** (POV)
Description: [full character description]
Current state: Trapped in Lattice core, heard screaming
Arc so far: Heard entity, investigating source
Relationships: parent_of Mira Kai, freed The Echo

**The Echo**
Description: [full character description]
Current state: Imprisoned in Lattice, screaming for 3B years
Relationships: imprisoned_by Lattice, freed_by Anselm

### Location:

**Lattice Core**
Description: [full location description]
Properties: quantum-locked, crystalline geometry, 300m below surface
Recent events here: Anselm Hears the Screaming

### Timeline:

**Superposition State**
Description: [timeline description]
Properties: experiences all timelines simultaneously
Physics: Block universe structure, about to fracture

---

## CAUSAL CHAIN (Tier 2)

### Previous Event:
**Anselm Hears the Screaming** (immediately before)
Summary: Anselm discovered impossible sound in quantum-locked core
Key details: Scream lasted 3 billion years, sounded aware and suffering

### Next Event:
**Mira Erased from Timeline** (immediately after)
Summary: Temporal echo from release erases Anselm's daughter from history
Key details: Only Anselm retains memories, photo flickers, records recompile

### Other Consequences:
**All timeline branches** - Reality fractures into multiple coexisting timelines
**Future Becomes Probability Fog** - Deterministic future dissolves

---

## CHARACTER CONTEXT (Tier 3)

Anselm's other events: [list of 7 events with brief summaries]
Anselm's voice: Technical, precise, compassionate, haunted by consequences

---

## THEMES TO WEAVE (Tier 5)

- Determinism vs Freedom: This event destroys deterministic structure
- Sacrifice for Love: Compassion for suffering entity (foreshadows later sacrifices)
- Choosing Presence Over Potential: Anselm chooses to ACT rather than observe

---

## SCIENTIFIC CONCEPTS (Tier 6)

**Block Universe Theory:**
Summary: [brief explanation]
How it applies: Lattice was artificially enforcing block universe structure

**Quantum Superposition at Macro Scale:**
Summary: [brief explanation]  
How it applies: Lattice release allows macro-scale superposition

---

## STYLE GUIDELINES

Reference style: Kubrick's 2001 (sparse, technical, precise)
- Use concrete technical details (instruments, readings, procedures)
- Short sentences for action, medium for observation
- Minimal metaphor, maximum clarity
- Sensory grounding: all 5 senses
- Show don't tell emotions through physical reactions

Avoid:
- Purple prose / overwriting
- Repetitive sentence structure
- Filter words (seemed, felt, appeared)
- More than 2 metaphors per paragraph

---

## PREVIOUS SCENE (For Continuity)

[Full text of "Anselm Hears the Screaming" - last 500 words]

---

GENERATE SCENE NOW.
```

---

## **FEATURE: Context Preview**

### **Before Generating, Show User:**

```
üìã AI Context Report

Entities included in generation:
‚úì Current event: Anselm Releases Lattice Core
‚úì 2 characters (Anselm Kai, The Echo)
‚úì 1 location (Lattice Core)
‚úì 1 timeline (Superposition State)
‚úì 4 related events (causal chain)
‚úì 3 themes
‚úì 2 scientific concepts
‚úì Previous scene (continuity)

Total context: ~87,000 tokens (43% of budget)

Excluded (not relevant):
‚úó 11 characters (Tarek, Elena, Saar, etc.)
‚úó 42 events (distant in causation)
‚úó 8 locations (not involved)

[Review Context] [Adjust Filters] [Generate]
```

---

## **DEBUGGING: Context Inspector**

### **Feature: See What AI Saw**

After generation, user can click "View AI Context" to see:

```
üîç Context Inspector

This is what the AI saw when generating "Anselm Releases Lattice Core":

Expand sections:
‚ñº System Prompt (10,234 tokens)
‚ñº Current Event (1,876 tokens)
‚ñº Direct Relationships (14,392 tokens)
  ‚ñº Anselm Kai (character)
  ‚ñº The Echo (character)
  ‚ñº Lattice Core (location)
  ‚ñº Superposition State (timeline)
‚ñº Causal Chain (9,841 tokens)
‚ñº Character Context (19,384 tokens)
‚ñº Themes (4,203 tokens)
‚ñº Scientific Concepts (5,891 tokens)
‚ñº Previous Scene (4,782 tokens)

[Export Full Context] [Report Issue] [Adjust for Next Scene]
```

---

## **SUMMARY: IMPLEMENTATION**

### **Core Algorithm:**

1. **Start with current event** (Tier 0)
2. **Fetch direct relationships** (Tier 1) - always include
3. **Fetch causal chain** (Tier 2) - 2 hops max
4. **Score all other entities** for relevance
5. **Include top 20** by relevance score
6. **Respect token budget** (~90K tokens max)
7. **Generate prompt** with structured sections
8. **Send to AI** with style guidelines

### **User Controls:**

- Context depth sliders
- Manual include/exclude entities
- Token budget display
- Context preview before generation
- Post-generation inspector

---

**This ensures AI has enough context to write coherently, but not so much it gets confused.**